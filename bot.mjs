import { Telegraf, Markup } from 'telegraf';

// Ð¢Ð²Ð¾Ð¹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐµÐ½Ð½Ñ‹Ð¹ Ñ‚Ð¾ÐºÐµÐ½
const bot = new Telegraf('8417875829:AAFt0JO8UuDoS7T5eXymIJjilOJMW90680M');

// Ð¡ÑÑ‹Ð»ÐºÐ° Ð½Ð° Ñ‚Ð²Ð¾Ð¹ ÐºÐ°Ð½Ð°Ð»
const CHANNEL_URL = 'https://t.me/+qxcAoFFsuvZiNWMy';

// ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° /start
bot.start((ctx) => {
  const name = ctx.from.first_name || 'Ð´Ñ€ÑƒÐ³';
  ctx.reply(
    `ÐŸÑ€Ð¸Ð²ÐµÑ‚, ${name}! ðŸ‘‹\n\n` +
    `Ð¯ Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð±Ð¾Ñ‚-Ð¿Ð¾Ð¼Ð¾Ñ‰Ð½Ð¸Ðº Ð¤Ð¾Ð¼Ñ‹. Ð Ð°Ð´ Ñ‚ÐµÐ±Ñ Ð²Ð¸Ð´ÐµÑ‚ÑŒ!\n\n` +
    `Ð—Ð´ÐµÑÑŒ Ñ‚Ñ‹ Ð¼Ð¾Ð¶ÐµÑˆÑŒ ÑƒÐ·Ð½Ð°Ñ‚ÑŒ Ð¾ Ð¼Ð¾Ð¸Ñ… Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ñ… Ð¸Ð»Ð¸ Ð·Ð°Ð´Ð°Ñ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾Ñ Ð»Ð¸Ñ‡Ð½Ð¾ Ð¼Ð½Ðµ.`,
    Markup.inlineKeyboard([
      [Markup.button.callback('ðŸ“‚ ÐœÐ¾Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹', 'show_projects')],
      [Markup.button.url('ðŸ“¢ ÐœÐ¾Ð¹ ÐºÐ°Ð½Ð°Ð»', CHANNEL_URL)]
    ])
  );
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÐºÐ½Ð¾Ð¿ÐºÐ¸ "ÐœÐ¾Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñ‹"
bot.action('show_projects', (ctx) => {
  ctx.answerCbQuery(); // Ð£Ð±Ð¸Ñ€Ð°ÐµÑ‚ "Ñ‡Ð°ÑÐ¸ÐºÐ¸" Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐµ
  ctx.reply(
    'ðŸš€ Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ñ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ Ð¸Ð·ÑƒÑ‡Ð°ÑŽ Fullstack-Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ!\n\n' +
    'ÐœÐ¾Ð¸ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ðµ Ñ†ÐµÐ»Ð¸:\n' +
    'â€¢ Ð›Ð¸Ñ‡Ð½Ñ‹Ð¹ ÑÐ°Ð¹Ñ‚ Ð½Ð° Next.js 15 (ÑƒÐ¶Ðµ Ð² Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐµ)\n' +
    'â€¢ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»ÐµÐ·Ð½Ñ‹Ñ… Telegram-Ð±Ð¾Ñ‚Ð¾Ð²\n' +
    'â€¢ Ð˜Ð·ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñ‹ Ð½ÐµÐ¹Ñ€Ð¾ÑÐµÑ‚ÐµÐ¹\n\n' +
    'Ð¡Ð»ÐµÐ´Ð¸ Ð·Ð° Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑÐ¾Ð¼ Ð² ÐºÐ°Ð½Ð°Ð»Ðµ!'
  );
});

// ÐÐ²Ñ‚Ð¾Ð¾Ñ‚Ð²ÐµÑ‚ Ð½Ð° Ð»ÑŽÐ±Ñ‹Ðµ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
bot.on('text', async (ctx) => {
  // ÐžÑ‚Ð²ÐµÑ‡Ð°ÐµÐ¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ
  await ctx.reply(
    'âœ… Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾! Ð¯ Ð¿ÐµÑ€ÐµÐ´Ð°Ð» ÐµÐ³Ð¾ Ð¤Ð¾Ð¼Ðµ.\n\n' +
    'Ð•ÑÐ»Ð¸ ÑÑ‚Ð¾ Ð²Ð°Ð¶Ð½Ñ‹Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ, Ð¾Ð½ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ñ‚ Ñ‚ÐµÐ±Ðµ Ð»Ð¸Ñ‡Ð½Ð¾ Ð² Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐµÐµ Ð²Ñ€ÐµÐ¼Ñ.',
    Markup.inlineKeyboard([
      [Markup.button.url('ÐŸÐ¾Ð´Ð¿Ð¸ÑÐ°Ñ‚ÑŒÑÑ Ð½Ð° ÐºÐ°Ð½Ð°Ð»', CHANNEL_URL)]
    ])
  );

  // Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð² ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒ (Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ñ‚Ñ‹ Ð²Ð¸Ð´ÐµÐ», ÐºÑ‚Ð¾ Ð¸ Ñ‡Ñ‚Ð¾ Ð¿Ð¸ÑˆÐµÑ‚)
  console.log(`--- ÐÐžÐ’ÐžÐ• Ð¡ÐžÐžÐ‘Ð©Ð•ÐÐ˜Ð• ---`);
  console.log(`ÐžÑ‚: ${ctx.from.first_name} (@${ctx.from.username || 'Ð½ÐµÑ‚_Ð½Ð¸ÐºÐ°'})`);
  console.log(`Ð¢ÐµÐºÑÑ‚: ${ctx.message.text}`);
  console.log(`-----------------------`);
});

// Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð°
bot.launch().then(() => {
  console.log('------------------------------------');
  console.log('ðŸš€ Ð‘ÐžÐ¢ Ð¤ÐžÐœÐ« Ð£Ð¡ÐŸÐ•Ð¨ÐÐž Ð—ÐÐŸÐ£Ð©Ð•Ð!');
  console.log('ÐÐ°Ð¿Ð¸ÑˆÐ¸ ÐµÐ¼Ñƒ Ð² Ð¢ÐµÐ»ÐµÐ³Ñ€Ð°Ð¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ.');
  console.log('------------------------------------');
});

// ÐŸÐ»Ð°Ð²Ð½Ð°Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°
process.once('SIGINT', () => bot.stop('SIGINT'));
process.once('SIGTERM', () => bot.stop('SIGTERM'));